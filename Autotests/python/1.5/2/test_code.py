import subprocess
import pytest

FILENAME = "index.py"

# –í—Ö–æ–¥–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏ –æ–∂–∏–¥–∞–µ–º—ã–µ –≤—ã–≤–æ–¥—ã
test_cases = [
    ("2020\n", "–í–∏—Å–æ–∫–æ—Å–Ω—ã–π –≥–æ–¥"),
    ("1900\n", "–ù–µ –≤–∏—Å–æ–∫–æ—Å–Ω—ã–π –≥–æ–¥"),
    ("2000\n", "–í–∏—Å–æ–∫–æ—Å–Ω—ã–π –≥–æ–¥"),
    ("2023\n", "–ù–µ –≤–∏—Å–æ–∫–æ—Å–Ω—ã–π –≥–æ–¥"),
    ("2400\n", "–í–∏—Å–æ–∫–æ—Å–Ω—ã–π –≥–æ–¥"),
    ("2100\n", "–ù–µ –≤–∏—Å–æ–∫–æ—Å–Ω—ã–π –≥–æ–¥"),
    ("1996\n", "–í–∏—Å–æ–∫–æ—Å–Ω—ã–π –≥–æ–¥"),
    ("1999\n", "–ù–µ –≤–∏—Å–æ–∫–æ—Å–Ω—ã–π –≥–æ–¥")
]

@pytest.mark.parametrize("input_value, expected_output", test_cases)
def test_leap_year(input_value, expected_output):
    # –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≥—Ä–∞–º–º—É
    process = subprocess.Popen(
        ['python3', FILENAME],
        stdin=subprocess.PIPE,
        stdout=subprocess.PIPE,
        stderr=subprocess.PIPE,
        text=True
    )
    stdout, stderr = process.communicate(input_value)

    # –†–∞–∑–±–∏–≤–∞–µ–º –≤—ã–≤–æ–¥ –Ω–∞ —Å—Ç—Ä–æ–∫–∏ –∏ —É–±–∏—Ä–∞–µ–º –ø—É—Å—Ç—ã–µ
    actual_lines = [line.strip() for line in stdout.split("\n") if line.strip()]

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—ã–≤–æ–¥ –µ—Å—Ç—å
    assert len(actual_lines) > 0, (
        f"–ü–æ—Ö–æ–∂–µ, –ø—Ä–æ–≥—Ä–∞–º–º–∞ –Ω–µ –≤—ã–≤–æ–¥–∏—Ç –Ω–∏—á–µ–≥–æ.\n"
        f"–ü—Ä–æ–≤–µ—Ä—å, –∏—Å–ø–æ–ª—å–∑—É–µ—à—å –ª–∏ print() –∏ input() –ø—Ä–∞–≤–∏–ª—å–Ω–æ."
    )

    # –ë–µ—Ä–µ–º –ø–µ—Ä–≤—É—é —Å—Ç—Ä–æ–∫—É –≤—ã–≤–æ–¥–∞
    actual = actual_lines[0]

    # –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Å –æ–∂–∏–¥–∞–µ–º—ã–º –≤—ã–≤–æ–¥–æ–º
    assert actual == expected_output, (
        f"–û—à–∏–±–∫–∞ –≤ –≤—ã–≤–æ–¥–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã!\n\n"
        f"–í–≤–µ–¥—ë–Ω –≥–æ–¥: {input_value.strip()}\n"
        f"–û–∂–∏–¥–∞–ª–æ—Å—å: {expected_output}\n"
        f"–ü–æ–ª—É—á–µ–Ω–æ: {actual}\n\n"
        f"üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞: –ø—Ä–æ–≤–µ—Ä—å —É—Å–ª–æ–≤–∏–µ –¥–ª—è –≤–∏—Å–æ–∫–æ—Å–Ω–æ–≥–æ –≥–æ–¥–∞ –∏ –∏—Å–ø–æ–ª—å–∑—É–π –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã."
    )

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –æ—à–∏–±–æ–∫ –≤ stderr –Ω–µ—Ç
    assert stderr.strip() == "", f"–ü—Ä–æ–≥—Ä–∞–º–º–∞ –≤—ã–∑–≤–∞–ª–∞ –æ—à–∏–±–∫—É:\n{stderr}"
