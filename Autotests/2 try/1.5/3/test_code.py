import subprocess
import pytest

FILENAME = "index.py"

# –¢–µ—Å—Ç–æ–≤—ã–µ –ø–∞—Ä—ã –ª–æ–≥–∏–Ω+–ø–∞—Ä–æ–ª—å –∏ –æ–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥
test_cases = [
    ("admin\nqwerty\n", "–î–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à–µ–Ω"),
    ("admin\n12345\n", "–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω"),
    ("user\nqwerty\n", "–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω"),
    ("user\n123\n", "–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω"),
    ("Admin\nqwerty\n", "–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω"),  # –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å –±–æ–ª—å—à–æ–π –±—É–∫–≤—ã
    ("admin\nQwerty\n", "–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω")   # –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å –±–æ–ª—å—à–æ–π –±—É–∫–≤—ã –≤ –ø–∞—Ä–æ–ª–µ
]

@pytest.mark.parametrize("input_value, expected_output", test_cases)
def test_login_password(input_value, expected_output):
    # –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≥—Ä–∞–º–º—É
    process = subprocess.Popen(
        ['python3', FILENAME],
        stdin=subprocess.PIPE,
        stdout=subprocess.PIPE,
        stderr=subprocess.PIPE,
        text=True
    )
    stdout, stderr = process.communicate(input_value)

    # –†–∞–∑–±–∏–≤–∞–µ–º –≤—ã–≤–æ–¥ –Ω–∞ —Å—Ç—Ä–æ–∫–∏ –∏ —É–±–∏—Ä–∞–µ–º –ø—É—Å—Ç—ã–µ
    actual_lines = [line.strip() for line in stdout.split("\n") if line.strip()]

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—ã–≤–æ–¥ –µ—Å—Ç—å
    assert len(actual_lines) > 0, (
        "–ü–æ—Ö–æ–∂–µ, –ø—Ä–æ–≥—Ä–∞–º–º–∞ –Ω–µ –≤—ã–≤–æ–¥–∏—Ç –Ω–∏—á–µ–≥–æ.\n"
        "–ü—Ä–æ–≤–µ—Ä—å, –∏—Å–ø–æ–ª—å–∑—É–µ—à—å –ª–∏ print() –∏ input() –ø—Ä–∞–≤–∏–ª—å–Ω–æ."
    )

    # –ë–µ—Ä–µ–º –ø–µ—Ä–≤—É—é —Å—Ç—Ä–æ–∫—É –≤—ã–≤–æ–¥–∞
    actual = actual_lines[0]

    # –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Å –æ–∂–∏–¥–∞–µ–º—ã–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º
    assert actual == expected_output, (
        f"–û—à–∏–±–∫–∞ –≤ –≤—ã–≤–æ–¥–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã!\n\n"
        f"–í–≤–µ–¥—ë–Ω –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å:\n{input_value.replace(chr(10), ' / ')}\n"
        f"–û–∂–∏–¥–∞–ª–æ—Å—å: {expected_output}\n"
        f"–ü–æ–ª—É—á–µ–Ω–æ: {actual}\n\n"
        f"üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞: –ø—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å –ª–æ–≥–∏—á–µ—Å–∫–∏–π –æ–ø–µ—Ä–∞—Ç–æ—Ä 'and' –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –ª–æ–≥–∏–Ω–∞ –∏ –ø–∞—Ä–æ–ª—è."
    )

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –æ—à–∏–±–æ–∫ –≤ stderr –Ω–µ—Ç
    assert stderr.strip() == "", f"–ü—Ä–æ–≥—Ä–∞–º–º–∞ –≤—ã–∑–≤–∞–ª–∞ –æ—à–∏–±–∫—É:\n{stderr}"
